<!DOCTYPE html>
<html>
  <head>
    <title>Broadcast message to WebSocket clients</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css">
    <script src="https://vuejs.org/js/vue.min.js"></script>
    <style>
      .background-wings {
        background-image: linear-gradient(black,#660000);
        background-size: cover;
      }
    </style>
  </head>
  <body>
    <noscript>
      <strong>We're sorry but this site doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div id="app" class="hero is-fullheight background-wings">
      <div class="hero-body">
        <div class="container">
          <div class="columns">
            <div class="column is-6-desktop is-offset-3-desktop is-12-mobile is-offset-0-mobile">
              <h1 class="is-size-1 has-text-centered has-text-white">
                Broadcast message to WebSocket clients
              </h1>
              <hr>
              <div class="box">
                <div class="field">
                  <textarea class="textarea" v-model="jsonData" rows="20"></textarea>
                </div>
                <button id="clearButton" 
                        class="button is-info is-fullwidth column is-offset-10-tablet is-2" 
                        :class="{ 'is-loading': isLoading }" 
                        @click="submit()" 
                        :disabled = "!jsonData">
                        Отправить
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
<script type="text/javascript">
  new Vue ({
    el: "#app",
    data: () => {
      return {
        isLoading: false,
        jsonData: '',
      }
    },
    methods:{
      submit() {
        this.isLoading = true
        fetch("/broadcast", this.getRequestOptions())
            .then(() => alert('Успешно'))
            .catch(e => alert('Произошла ошибка ' + e))
            .finally(() => this.isLoading = false);
      },
      getRequestOptions() {
        return {
          method: "POST",
          headers: { "Content-Type": "application/json"},
          body: this.jsonData
        }
      },
      clearFields() {
        this.jsonData = '';
      },
    }
  });
</script>

